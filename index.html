<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Impact Calculator</title>
    <meta name="author" content="Alex Rasch">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <nav class="navbar bg-body-tertiary fixed-top">
        <div class="container">
          <a class="navbar-brand" href="#">GameImpact</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="offcanvasNavbarLabel">GameImpact</h5>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="#">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">Link</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>

    <div class="container mb-5 mt-5">
        <h1>Game Impact Calculator</h1>
    </div>

    <!-- Drop rate-->

    <!--Critical strike -->
    <div class="container">
        <p>Calculate the probability of a critical strike</p>
        <div class="form-floating mb-3">
            <input type="number" class="form-control" id="odds" step="0.01" min="0" max="100">
            <label for="odds">Event Probability (%):</label>
        </div>
        <div class="form-floating mb-3">
            <input type="number" class="form-control" id="events" min="1" max="100">
            <label for="events">Number of Events*:</label>
        </div>

        <div class="d-grid gap-2">
            <button onclick="calculateProbability()" class="btn btn-info">Calculate Probability</button>
        </div>
        <p id="result">Probability:</p>
        <table id="probabilityTable" class="table table-striped" border="1">
            <tr>
                <th>Number of Events</th>
                <th>Chosen Odds (%)</th>
                <th>Probability (%)</th>
            </tr>
        </table>
    </div>

    <!-- Cooldown -->
    <div class="container">
        <p>Calculate the impact of cooldown, attack speed increase or decrease</p>
                <div class="form-floating mb-3">
                    <input type="number" class="form-control" id="speed" step="0.01" min="0">
                    <label for="speed">Current cooldown (sec):</label>
                </div>

                <div class="form-floating mb-3">
                    <input type="number" class="form-control" id="speedChange" step="0.01">
                    <label for="speedChange">Cooldown Change (%):</label>
                </div>

                <div class="d-grid gap-2">
                    <button onClick="calculateCooldown()" class="btn btn-info">Calculate cooldown change</button>
                </div>
                <p id="resultCoolDown">New cooldown:</p>
 
    </div>
    <script>
        function calculateProbability() {
            var oddsPercentage = parseFloat(document.getElementById("odds").value);
            var numberOfEvents = parseInt(document.getElementById("events").value);

            if (!isValidInput(oddsPercentage, numberOfEvents)) {
                return;
            }

            clearTable();

            var odds = oddsPercentage / 100;
            var probability = calculateEventProbability(odds, numberOfEvents);
            displayResult(probability);

            generateTableRows(oddsPercentage, odds, numberOfEvents);
        }

        function calculateCooldown() {
            var attackSpeed = parseFloat(document.getElementById("speed").value);
            var speedChange = parseFloat(document.getElementById("speedChange").value);

            // ToDo input validation


            var newAttackSpeed = calculateNewAttackSpeed(attackSpeed, speedChange);
            displayNewCoolDown(newAttackSpeed);

            clearTable();
        }

        function isValidInput(oddsPercentage, numberOfEvents) {
            if (isNaN(oddsPercentage) || isNaN(numberOfEvents) || oddsPercentage < 0 || oddsPercentage > 100 || numberOfEvents < 1) {
                document.getElementById("result").innerHTML = "Please enter valid values.";
                return false;
            }
            return true;
        }

        /* Math functions */

        function calculateNewAttackSpeed(currentSpeed, speedChange) {
            return currentSpeed * (1 + speedChange / 100);
        }

        function calculateEventProbability(odds, numberOfEvents) {
            return 1 - Math.pow(1 - odds, numberOfEvents);
        }

        /* Display functions */

        function displayResult(probability) {
            document.getElementById("result").innerHTML = "Probability: " + (probability * 100).toFixed(2) + "%";
        }

        function displayNewCoolDown(newAttackSpeed) {
            document.getElementById("resultCoolDown").innerHTML = "New cooldown: " + newAttackSpeed.toFixed(2) + " sec";
        }
        /*  Table functions */

        function generateTableRows(oddsPercentage, odds, numberOfEvents) {
            var table = document.getElementById("probabilityTable");
            var eventCounts = [1, 2, 3, 4, 5, 10, 15];

            for (var i = 0; i < eventCounts.length; i++) {
                var count = eventCounts[i];
                var newRow = table.insertRow(-1);
                var newCell1 = newRow.insertCell(0);
                var newCell2 = newRow.insertCell(1);
                var newCell3 = newRow.insertCell(2);

                var eventProbability = calculateEventProbability(odds, count);
                newCell1.innerHTML = count;
                newCell2.innerHTML = oddsPercentage + "%";
                newCell3.innerHTML = (eventProbability * 100).toFixed(2) + "%";
            }
        }

        function clearTable() {
            var table = document.getElementById("probabilityTable");
            var rowCount = table.rows.length;
            for (var i = rowCount - 1; i > 0; i--) {
                table.deleteRow(i);
            }
        }
    </script>

</body>

</html>